---
tipue_search_active: true
exclude_from_search: true
---

<!DOCTYPE html>
<html>

    <head>
        <title>{% if page.title %}{{ page.title }} – {% endif %}{{ site.name }} – {{ site.description }}</title>
        {% include meta.html %}
        <link rel="stylesheet" type="text/css" href="{{ site.baseurl }}/style.css" />
        <link rel="alternate" type="application/rss+xml" title="{{ site.name }} - {{ site.description }}" href="{{ site.baseurl }}/feed.xml" />
        <link rel="shortcut icon" type="image/x-icon" href="{{ site.baseurl }}/images/favicon.ico" />
        <!-- Preload critical images for better performance -->
        <link rel="preload" href="{{ site.avatar | prepend: site.baseurl }}" as="image" type="image/webp">
        <!-- Updated libraries: jQuery 3.7.1 local, Bootstrap 3.3.7 local -->
        <script src="{{ '/bootstrap/js/jquery.min.js' | prepend: site.baseurl }}"></script>
        <script src="{{ '/bootstrap/js/bootstrap.min.js' | prepend: site.baseurl }}"></script>
        <link rel="stylesheet" href="{{ '/bootstrap/css/bootstrap.min.css' | prepend: site.baseurl }}">
        <script src="{{ '/bootstrap/js/directory.js' | prepend: site.baseurl }}"></script>
        {% if page.tipue_search_active or layout.tipue_search_active %}
        <script src="{{ '/assets/tipuesearch/tipuesearch_content.js' | prepend: site.baseurl }}"></script>
        <link rel="stylesheet" href="{{ '/assets/tipuesearch/css/tipuesearch.css' | prepend: site.baseurl }}">
        <script src="{{ '/assets/tipuesearch/tipuesearch_set.js' | prepend: site.baseurl }}"></script>
        <script src="{{ '/assets/tipuesearch/tipuesearch.min.js' | prepend: site.baseurl }}"></script>
        {% endif %}
        <!-- Mermaid.js loaded conditionally and asynchronously -->
        <script>
        // Check if page contains mermaid diagrams
        document.addEventListener('DOMContentLoaded', function() {
            if (document.querySelector('.language-mermaid, .mermaid')) {
                // Load Mermaid from CDN asynchronously
                var script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js';
                script.async = true;
                script.onload = function() {
                    mermaid.initialize({
                        startOnLoad: true,
                        theme: 'default'
                    });
                    mermaid.run();
                };
                document.head.appendChild(script);
            }
        });
        </script>
    </head>

    <body>
        <div class="wrapper-masthead">
            <div class="container">
                <header class="masthead clearfix">
                    <a href="{{ site.baseurl }}/" class="site-avatar"><img src="{{ site.avatar }}" alt="{{ site.name }}" loading="eager" /></a>
                    <div class="site-info">
                        <h1 class="site-name"><a href="{{ site.baseurl }}/">{{ site.name }}</a></h1>
                        <br>
                        <p class="site-description">{{ site.description }}</p>
                    </div>
                    <nav>
                        <a href="{{ site.baseurl }}/">Blog</a>
                        <a href="{{ site.baseurl }}/directory">Directory</a>
                        <!-- <a href="{{ site.baseurl }}/assets/paper.pdf">Resume</a> -->
                        <a href="{{ site.baseurl }}/about">About</a>
                    </nav>

                    <div id = "search-div">
                        <form action="{{ page.url | prepend: site.baseurl }}" onsubmit="return false;">
                            <div class="tipue_search_right">
                                <img src="{{ '/assets/tipuesearch/search.png' | prepend: site.baseurl }}" class="tipue_search_icon">
                                <input type="text" name="q" id="tipue_search_input" pattern=".{1,}" title="At least 1 character" required>
                            </div>
                        </form>

                        <div class="modal fade search-modal" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="searchModalTitle" aria-hidden="true">
                            <div class="modal-dialog modal-lg modal-dialog-centered search-modal__dialog" role="document">
                                <div class="modal-content search-modal__content">
                                    <div class="search-modal__header">
                                        <div class="search-modal__heading">
                                            <p class="search-modal__eyebrow">Site Search · 站内检索</p>
                                            <h5 class="search-modal__title" id="searchModalTitle">Search Results</h5>
                                            <p class="search-modal__subtitle">按 Enter 键即可打开模态框并刷新 Tipue 结果。</p>
                                        </div>
                                        <button type="button" class="close search-modal__close" data-dismiss="modal" aria-label="关闭">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="search-modal__body">
                                        <div id="tipue_search_content"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>
            </div>
        </div>
        <div id="main" role="main" class="container">
            {{ content }}
        </div>
        <div class="wrapper-footer">
            <div class="container">
                <footer class="footer">
                    {% include svg-icons.html %}
                </footer>
            </div>
        </div>
        {% include analytics.html %}
        <!-- Image optimization: lazy loading and URL parameter optimization -->
        <script>
        (function() {
            'use strict';
            function optimizeImages() {
                var contentAreas = document.querySelectorAll('.post .entry, article.post, .entry');
                contentAreas.forEach(function(area) {
                    var images = area.querySelectorAll('img');
                    images.forEach(function(img, index) {
                        var src = img.getAttribute('src');
                        if (!src) return;

                        // Optimize Pexels images - add compression and size limit
                        if (src.includes('images.pexels.com') && !src.includes('w=') && !src.includes('auto=compress')) {
                            var sep = src.includes('?') ? '&' : '?';
                            img.setAttribute('src', src + sep + 'auto=compress&cs=tinysrgb&w=800');
                        }

                        // Optimize Unsplash images
                        if (src.includes('images.unsplash.com') && !src.includes('w=')) {
                            var sep = src.includes('?') ? '&' : '?';
                            img.setAttribute('src', src + sep + 'w=800&q=80');
                        }

                        // First image eager (LCP), rest lazy loaded
                        if (index > 0) {
                            img.setAttribute('loading', 'lazy');
                        }
                        img.setAttribute('decoding', 'async');
                    });
                });
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', optimizeImages);
            } else {
                optimizeImages();
            }
        })();
        </script>
    </body>
</html>
